parameters:
- name: project
  type: string
- name: netFrameworkVersion
  type: string
- name: configuration
  type: string
- name: configPattern
  type: string

steps:
- task: replacetokens@3
  displayName: 'Configure'
  inputs:
    targetFiles: '$(Pipeline.Workspace)/s/**/${{ parameters.configPattern }}'
    encoding: 'auto'
    writeBOM: true
    verbosity: 'detailed'
    actionOnMissing: 'warn'
    keepToken: false
    tokenPrefix: '#{'
    tokenSuffix: '}#'
    useLegacyPattern: false
    enableTelemetry: true

- task: DotNetCoreCLI@2
  displayName: 'Publish'
  inputs:
    command: publish
    publishWebProjects: True
    arguments: '--configuration ${{ parameters.configuration }} --framework ${{ parameters.netFrameworkVersion }} --output $(Build.ArtifactStagingDirectory)'
    zipAfterPublish: True

- task: PublishPipelineArtifact@1
  displayName: 'Pack'
  inputs:
    targetPath: $(Build.ArtifactStagingDirectory)
    artifactType: 'pipeline'
    artifactName: 'package'